<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lapak Penjualan Digital</title>
    <meta name="description" content="Toko online penjualan produk digital dengan berbagai kategori produk">
    <link rel="stylesheet" href="style.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCUqgAA2e__tiaQjQuRRZcQTsLIM5JC1nI",
            authDomain: "marketplacesj-d0767.firebaseapp.com",
            projectId: "marketplacesj-d0767",
            messagingSenderId: "443129735278",
            appId: "1:443129735278:web:db6191a42628bf47fc5e7f",
            measurementId: "G-BDWGEB9T5T"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.firebaseApp = app;
        window.db = db;
        window.firebaseModules = {
            collection, getDocs, addDoc, updateDoc, deleteDoc, doc, serverTimestamp, query, orderBy
        };
    </script>
</head>
<body>
    <!-- OVERLAY UNTUK SIDEBAR -->
    <div class="sidebar-overlay" id="overlay"></div>
    
    <!-- SIDEBAR KIRI - FAVORIT -->
    <div id="wishlist-sidebar">
        <div class="wishlist-header">
            <h2 style="margin:0;">‚ù§Ô∏è Daftar Favorit</h2>
            <button onclick="closeSidebars()" style="background:none; border:none; font-size:24px; cursor:pointer;">√ó</button>
        </div>
        <div id="wishlist-items"></div>
        <div style="margin-top: 20px; padding: 20px; text-align: center; color: #666;">
            <p>Klik tombol hati pada produk untuk menambahkannya ke favorit</p>
        </div>
    </div>
    
    <!-- SIDEBAR KANAN - KERANJANG -->
    <div id="cart-sidebar">
        <div class="cart-header">
            <h2 style="margin:0;">üõí Keranjang Belanja</h2>
            <button onclick="closeSidebars()" style="background:none; border:none; font-size:24px; cursor:pointer;">√ó</button>
        </div>
        <div id="cart-items"></div>
        <div style="margin-top: 20px;">
            <div style="display:flex; justify-content:space-between; font-size:18px; font-weight:bold; margin-bottom:15px;">
                <span>Total:</span>
                <span id="cart-total">Rp 0</span>
            </div>
            <button onclick="checkoutCart()" style="width:100%; padding:15px; background:#25D366; color:white; border:none; border-radius:8px; font-size:16px; font-weight:bold; cursor:pointer;">
                üí¨ Checkout via WhatsApp
            </button>
            <button onclick="cart = []; updateCart(); showToast('Keranjang dikosongkan');" style="width:100%; padding:10px; background:#6C757D; color:white; border:none; border-radius:8px; margin-top:10px; cursor:pointer;">
                üóëÔ∏è Kosongkan Keranjang
            </button>
        </div>
    </div>
    
    <header>
        <h1>üõí Lapak Penjualan Digital</h1>
        <div>
            <button id="wishlist-btn">‚ù§Ô∏è Favorit (<span id="wishlist-count">0</span>)</button>
            <button id="cart-btn">üõí Keranjang (<span id="cart-count">0</span>)</button>
            <button id="mode-toggle">üåô Mode Gelap</button>
            <button id="admin-btn">üîß Area Admin</button>
        </div>
    </header>
    
    <main id="toko-container">
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="Cari produk...">
            <button onclick="cariProduk()">üîç Cari</button>
            <button onclick="resetPencarian()">üîÑ Reset</button>
        </div>
        
        <div class="category-filter"></div>
        
        <h2>Produk Terbaru <span id="product-count">(0 produk)</span></h2>
        
        <div id="loading" style="display:none; text-align: center; padding: 40px;">
            <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px;"></div>
            <p>Memuat produk...</p>
        </div>
        
        <div id="daftar-produk" class="produk-grid"></div>
        <div id="no-products" style="display:none; text-align:center; padding:40px;">
            <p>Belum ada produk tersedia.</p>
        </div>
    </main>
    
    <section id="admin-area" class="admin-hidden">
        <div id="login-form">
            <h2>Masuk Admin</h2>
            <input type="text" id="admin-username" placeholder="Username">
            <input type="password" id="admin-password" placeholder="Password">
            <button onclick="loginAdmin()">Login</button>
            <button onclick="batalAdmin()" class="btn-secondary">Batal</button>
            <p id="login-msg"></p>
        </div>
        
        <div id="admin-dashboard" class="dashboard-hidden">
            <h2>üõ†Ô∏è Kelola Produk</h2>
            
            <div class="admin-section">
                <h3>Tambah Produk Baru</h3>
                <input type="text" id="input-nama" placeholder="Nama Produk" maxlength="50">
                <input type="number" id="input-harga" placeholder="Harga" min="1000" max="10000000">
                <input type="text" id="input-nomor" placeholder="Nomor WA Penjual (628...)" pattern="62\d{9,12}">
                <input type="text" id="input-deskripsi" placeholder="Deskripsi Produk (opsional)">
                <select id="input-kategori" style="width:100%; padding:12px; margin-bottom:15px; border:2px solid #ddd; border-radius:8px;"></select>
                <div class="upload-area">
                    <label for="input-gambar">Gambar Produk (opsional):</label>
                    <input type="file" id="input-gambar" accept="image/*" onchange="previewImage('input-gambar', 'preview-tambah')">
                    <div id="preview-tambah" class="image-preview">
                        <p>Pratinjau gambar akan muncul di sini</p>
                    </div>
                    <small>Ukuran maksimal: 500KB. Format: JPG, PNG</small>
                </div>
                <button onclick="tambahProduk()">Tambah Produk</button>
            </div>
            
            <div class="admin-section" id="edit-section" style="display:none;">
                <h3>Edit Produk</h3>
                <input type="hidden" id="edit-index">
                <input type="hidden" id="edit-id">
                <input type="text" id="edit-nama" placeholder="Nama Produk" maxlength="50">
                <input type="number" id="edit-harga" placeholder="Harga" min="1000" max="10000000">
                <input type="text" id="edit-nomor" placeholder="Nomor WA Penjual (628...)" pattern="62\d{9,12}">
                <input type="text" id="edit-deskripsi" placeholder="Deskripsi Produk">
                <select id="edit-kategori" style="width:100%; padding:12px; margin-bottom:15px; border:2px solid #ddd; border-radius:8px;"></select>
                <div class="upload-area">
                    <label for="edit-gambar">Gambar Produk:</label>
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                        <button type="button" onclick="document.getElementById('edit-gambar').click()" class="btn-secondary">
                            Ubah Gambar
                        </button>
                        <button type="button" onclick="hapusGambarEdit()" class="btn-hapus">
                            Hapus Gambar
                        </button>
                    </div>
                    <input type="file" id="edit-gambar" accept="image/*" style="display:none;" onchange="previewImage('edit-gambar', 'preview-edit')">
                    <div id="preview-edit" class="image-preview">
                        <p>Gambar saat ini akan muncul di sini</p>
                    </div>
                    <small>Kosongkan jika tidak ingin mengubah gambar</small>
                </div>
                <button onclick="simpanEdit()">Simpan Perubahan</button>
                <button onclick="batalEdit()" class="btn-secondary">Batal Edit</button>
            </div>
            
            <div class="admin-section">
                <h3>Produk Saat Ini <small>(Klik untuk edit)</small></h3>
                <div id="admin-produk-list" class="produk-grid"></div>
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button onclick="logoutAdmin()" class="btn-logout">Logout</button>
                <button onclick="batalAdmin()" class="btn-secondary">Kembali ke Toko</button>
            </div>
        </div>
    </section>
    
    <footer>
        <p>&copy; 2024 Lapak Digital | <span id="total-products">0</span> produk tersedia</p>
        <p id="firebase-status" style="font-size: 12px; color: #28a745;">‚úÖ Terhubung ke Firebase</p>
    </footer>
    
    <script src="script.js"></script>
</body>
</html>
